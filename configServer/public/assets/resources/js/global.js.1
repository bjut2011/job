function getMegaFromBytes(e){return Math.round(e/1048576)}function getFunctionName(e){var s=e.toString();return s=s.substr("function ".length),s=s.substr(0,s.indexOf("("))}function isNotEmptyString(e){return null!=e&&void 0!=e&&""!=e}function disableLnkBtn(e){e.hasClass("pagination-btn-enable")&&e.removeClass("pagination-btn-enable"),e.hasClass("pagination-btn-disable")||e.addClass("pagination-btn-disable")}function enableLnkBtn(e){e.hasClass("pagination-btn-disable")&&e.removeClass("pagination-btn-disable"),e.hasClass("pagination-btn-enable")||e.addClass("pagination-btn-enable")}String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.unique=function(){},Array.prototype.remove=function(e){var s=this.indexOf(e);return s>=0&&(this.splice(s,1),!0)},Array.prototype.removeOnIndex=function(e){return e<this.length&&(this.splice(e,1),!0)},Array.prototype.contains=function(e){var s=this.indexOf(e);return s>=0},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.ltrim=function(){return this.replace(/^\s+/,"")},String.prototype.rtrim=function(){return this.replace(/\s+$/,"")},String.prototype.fulltrim=function(){return this.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")},String.prototype.equals=function(e){return this==String(e)},String.prototype.equalsIgnoreCase=function(e){return this.toUpperCase()==String(e).toUpperCase()};var searchUtil=function(e,s,t,n,a,l,r,i,o,c,u){function g(){d(null!=_&&isNotEmptyString(_.pageNo)?_.pageNo:null)}function d(e){if(null!=e&&""!=e||(e=1),null!=x)for(var s=0;s<x.length;s++)null==x[s].value&&(x[s].value="");if(e==N.pageNo){if(null!=N&&null!=N.pageNo&&null!=N.records){var t=$("#"+b);t.unbind("click"),disableLnkBtn(t),null!=M&&M(N,_,w),w.pageNo=_.pageNo,w.records=_.records,_.pageNo=N.pageNo,_.records=N.records,N.pageNo=null,N.records=null;var n=$("#"+C);n.unbind("click"),n.click(function(){d(w.pageNo)}),$("#"+y).html(f(_.records)),$("#"+B).text(_.pageNo),e-1>0?(enableLnkBtn(t),p(e-1,-1)):(disableLnkBtn(t),t.unbind("click")),null!=k&&k(N,_,w)}}else if(e==w.pageNo){if(null!=w&&null!=w.pageNo&&null!=w.records){var n=$("#"+C);n.unbind("click"),disableLnkBtn(n),null!=M&&M(N,_,w),N.pageNo=_.pageNo,N.records=_.records,_.pageNo=w.pageNo,_.records=w.records,w.pageNo=null,w.records=null;var a=$("#"+b);a.unbind("click"),a.click(function(){d(N.pageNo)}),$("#"+y).html(f(_.records)),$("#"+B).text(_.pageNo),e-1>0?enableLnkBtn(a):disableLnkBtn(a),p(e+1,1),null!=k&&k(N,_,w)}}else null!=M&&M(N,_,w),e-1>0&&p(e-1,-1),p(e,0),e-1>0?(enableLnkBtn($("#"+b)),p(e-1,-1)):disableLnkBtn($("#"+b)),p(e+1,1);E=!1}function h(e,s,t){if(null==s||0==s)_.pageNo=e.pageNo,_.records=e.records,$("#"+y).html(f(_.records)),$("#"+B).text(t),null!=k&&k(N,_,w);else if(s<0){N.pageNo=e.pageNo,N.records=e.records;var n=$("#"+b);n.unbind("click"),n.click(function(){d(t)}),null!=N&&null!=N.records&&N.records.length>0?enableLnkBtn(n):disableLnkBtn(n)}else if(s>0){w.pageNo=e.pageNo,w.records=e.records;var a=$("#"+C);null!=e.records&&e.records.length>0&&(a.unbind("click"),a.click(function(){d(t)})),null!=w&&null!=w.records&&w.records.length>0?enableLnkBtn(a):disableLnkBtn(a)}}function p(e,s){if(null!=e&&""!=e||(e=1),null!=x)for(var t=0;t<x.length;t++)null==x[t].value&&(x[t].value="");var n={pageNo:e};if(null!=x)for(var t=0;t<x.length;t++)n[x[t].key]=x[t].value;var a=$(".portlet-body");null!=I&&(a=$("#"+I)),App.blockUI({target:a,textOnly:!0}),$.ajax({type:"GET",dataType:"json",url:S,data:n,contenttype:"application/json; charset=utf-8",datatype:"json",beforeSend:function(e){e.setRequestHeader("If-Modified-Since","0"),e.setRequestHeader("Cache-Control","no-cache")},success:function(t){return App.unblockUI(a),"FAIL"==t.result?(m(t.result,t.message),!1):void h(t,s,e)},error:function(e){return App.unblockUI(a),v(e.result,e.message),!1}})}var f=e,m=s,v=t,M=n,k=a,y=l,B=r,b=i,C=o,S=c,N={pageNo:"",records:""},w={pageNo:"",records:""},_={pageNo:"",records:""},x=null,E=!1,I=u;this.convertKeywordsSearchable=function(e){if(!isNotEmptyString(e))return"";for(var s=e.replace(/;/g," ").replace(/\uff1b/g," ").split(" "),t=0;t<s.length;t++)""==s[t].trim()?s.remove(s[t]):t++;return s.join(" ")},this.setSearchParemeter=function(e,s){null==x&&(x=[]);for(var t=!1,n=0;n<x.length;n++)if(x[n].key==e){x[n].value=s,t=!0;break}t||x.push({key:e,value:s}),E=!0},this.addSearchParameter=function(e,s){null==x&&(x=[]),x.push({key:e,value:s}),E=!0},this.getCurrentPage=function(){return null!=_?_.pageNo:null},this.searchWithPreload=d,this.refreshCurrentPage=g},MessageBundle=new function(){this.autoRefreshHintTimer=null,this.autoRefreshHintInterval=1e4,this.twinkleTimeOffSet=1e4,this.twinkleDuration=6e4,this.iconClass="glyphicon glyphicon-envelope",this.hintContainerId="showmsg",this.twinkleTimer=null,this.twinkleInterval=1e3,this.contextPath=null,this.isInited=!1,this.showMessageHint=function(e){var s=$("#"+this.hintContainerId);null!=s&&s.length>0&&(s.children().remove(),s.html(""),s.html("<span id='span_icon' class='"+this.iconClass+"'></span> &nbsp;"),null!=e&&e>0?(s.append("\u65b0\u6d88\u606f("+e+")"),this.twinkleIcon(this.twinkleTimeOffSet,this.twinkleDuration)):s.append("&nbsp;\u6d88\u606f&nbsp;&nbsp;"))},this.twinkleIcon=function(e,s){null==this.twinkleTimer&&void 0==this.twinkleTimer||(clearTimeout(this.twinkleTimer),this.twinkleTimer=null);var t=$("#span_icon");if(s<=0)return t.hasClass(this.iconClass)||t.addClass(this.iconClass),!1;s<this.twinkleDuration&&(t.hasClass(this.iconClass)?t.removeClass(this.iconClass):t.addClass(this.iconClass));var n="MessageBundle.twinkleIcon(MessageBundle.twinkleInterval, ("+s+" - MessageBundle.twinkleInterval));";this.twinkleTimer=setTimeout(n,e)},this.refreshHint=function(){this.SearchMessages(!0,!1,!0,MessageBundle.refreshHintSuccessCallBack,MessageBundle.refreshHintErrorCallBack)},this.refreshHintSuccessCallBack=function(e){var s=0;"OK"==e.result&&isNotEmptyString(e.totalRecord)&&(s=e.totalRecord),MessageBundle.showMessageHint(s)},this.refreshHintErrorCallBack=function(){MessageBundle.showMessageHint(0)},this.initMsgDlg=function(e){this.isInited||($.ajax({url:this.contextPath+"/system/get_message.htm",type:"get",dataType:"html",async:!1,success:function(e){MessageBundle.isInited=!0,$("div#systemMessageDialog").html(""),$("div#systemMessageDialog").html(e),MessageBundle.eventsBind()}}),"MERCHANT"==e&&$("#li_new_msg").hide())},this.eventsBind=function(){$("#btn_save_msg").on("click",function(e){e.preventDefault(),$("#form_new_message").submit()}),$("#form_new_message").validate({errorClass:"error-notification",errorElement:"div",rules:{msg_title:{required:!0,maxlength:100},msg_receivers:{required:!0}},messages:{msg_title:{maxlength:"\u6807\u9898\u4e0d\u5f97\u8d85\u8fc7100\u4e2a\u5b57\u7b26"},msg_receivers:{required:"\u8bf7\u8f93\u5165\u6536\u4fe1\u4eba\u5e10\u53f7"}},submitHandler:function(){var e=$("#msg_title").val(),s=$("#msg_receivers").select2("val"),t=$("#msg_content").val();return MessageBundle.saveMsg(s,e,t),!1}}),$("#msg_receivers").select2({minimumInputLength:2,multiple:!0,allowClear:!0,formatResult:MessageBundle.formatResult,formatSelection:MessageBundle.formatSelection,containerCssClass:"msg-receiver-input",dropdownCssClass:"bigdrop",escapeMarkup:function(e){return e},ajax:{type:"GET",dataType:"json",url:MessageBundle.contextPath+"/account/searchaccount.htm",quietMillis:100,data:function(e,s){return{keywords:e,pageNo:s}},results:function(e){if(preload_data=[],null!=e.records&&e.records.length>0)for(var s=0;s<e.records.length;s++){var t=e.records[s].id,n=null;n=isNotEmptyString(e.records[s].fullname)?e.records[s].fullname+"("+e.records[s].username+")":e.records[s].username,preload_data.push({id:t,name:n})}var a=!0;return e.records.length<10&&(a=!1),{results:preload_data,more:a}}}})},this.formatResult=function(e){var s;return e&&(s="<table class='movie-result'><tr><td class='movie-info'>",s+="<div class='movie-title'>"+e.name+"</div>",s+="</td></tr></table>"),s},this.formatSelection=function(e){return e.name},this.closeMsgDlg=function(){$("div#systemMessageDialog").modal("hide")},this.showMsgDlg=function(){this.isInited||this.initMsgDlg(),this.SearchMessages(!1,null,!0,MessageBundle.showMsgSuccessCallBack,MessageBundle.showMsgErrorCallBack),this.SearchMessages(!1,null,!1,MessageBundle.showSentBoxMsgErrorCallBack,MessageBundle.showMsgErrorCallBack),$("div#systemMessageDialog").modal("show")},this.showMsgSuccessCallBack=function(e){if("OK"==e.result){var s=MessageBundle.renderMsgLst(e.records,!1),t=$("#inMsglist");t.children().remove(),t.html(s)}},this.showSentBoxMsgErrorCallBack=function(e){if("OK"==e.result){var s=MessageBundle.renderMsgLst(e.records,!0),t=$("#sentMsglist");t.children().remove(),t.html(s)}},this.showMsgErrorCallBack=function(){},this.paginationProcess=function(e){1!=e&&0!=e&&(e=!1)},this.renderMsgLst=function(e,s){var t="";if(null!=e&&e.length>0)for(var n=0;n<e.length;n++){var a=e[n],l=a.id,r=(a.senderId,a.receiverId,a.title),i=r;null!=i&&i.length>15&&(i=i.substring(0,20)+" ...");var o=a.content,c=o;null!=c&&c.length>20&&(c=c.substring(0,20)+" ...");var c=o;null!=c&&c.length>30&&(c=c.substring(0,30)+" ...");var u=a.isRead,g=(a.isFlaged,a.createDatetime),d=(a.parentMsgId,u?"normal":"bold"),h="\u6765\u81ea\uff1a"+(isNotEmptyString(a.senderFullName)?a.senderFullName:a.senderUserName),p="",f="",m=!1;if(null!=a.receiverInfos&&a.receiverInfos.length>0){receiverLst=[];for(var n=0;n<a.receiverInfos.length;n++){var v=a.receiverInfos[n],M=isNotEmptyString(v.fullName)?v.fullName:v.userName;receiverLst.push(M)}p="\u53d1\u7ed9\uff1a"+receiverLst.join(", "),f=p,p.length>15&&(m=!0,p=p.substring(0,12)+" ...")}var k=s?p:h,y=s?f:h,B="";B+="<div id='message_"+l+"' class='panel-group accordion'><div class='panel panel-default msgpanel'>",B+="<div>",B+="<a id='lnk_toggle_"+l+"' onclick='javascript:MessageBundle.setMsgRead(this);' style='font-weight:"+d+";' class='accordion-toggle accordion-toggle-styled collapsed list-group-item' href='#' data-target='#collapse_"+l+"' data-parent='#message_"+l+"' data-toggle='collapse'>",B+="<span class='name' style='min-width: 120px; display: inline-block;'>"+k,m&&(B+="<i style='margin-left:5px;' class='glyphicon glyphicon-comment' rel='tooltip' title='"+y+"' id=''></i>"),B+="</span>",B+="<span class='' style='margin-left:20px;'>"+i+"</span>",B+="<span class='text-muted' style='font-size: 11px;'>&nbsp;&nbsp;-&nbsp;&nbsp;"+o+"</span>",B+="<span class='badge'>"+g+"</span>",B+="<span class='pull-right'><span id='delete_"+l+"' onclick='javascript:MessageBundle.deleteMsg(this);' class='glyphicon glyphicon-remove'> </span></span>",B+="</a>",B+="</div>",B+="<div id='collapse_"+l+"' class='panel-collapse collapse' style='height: 0px;'>",B+="<div class='panel-header'>",B+="<p>"+r+"</p>",B+="</div>",B+="<div class='panel-body'>",B+="<p>"+o+"</p>",B+="</div>",B+="</div>",B+="</div></div>",t+=B}return t},this.saveMsg=function(e,s,t){return MessageBundle.SendMessage(e,s,t,MessageBundle.saveMsgSuccessCallBack,MessageBundle.saveMsgErrorCallBack),!1},this.saveMsgSuccessCallBack=function(){$("#msg_title").val(""),$("#msg_content").val(""),$("#msg_receivers").select2("val",""),$.pnotify({title:"\u53d1\u9001\u4fe1\u606f\u6210\u529f",type:"success",delay:1500}),MessageBundle.SearchMessages(!1,null,!1,MessageBundle.showSentBoxMsgErrorCallBack,MessageBundle.showMsgErrorCallBack)},this.saveMsgErrorCallBack=function(){$.pnotify({title:"\u53d1\u9001\u4fe1\u606f\u5931\u8d25",type:"error",delay:1500})},this.setMsgRead=function(e){var s=$(e);if(700==s.css("font-weight")){s.css("font-weight","normal");var t=e.id.substring("lnk_toggle_".length);this.SetMessageRead(!0,t,MessageBundle.setMsgReadSuccessCallBack,MessageBundle.setMsgReadSuccessCallBack.setMsgReadErrorCallBack)}},this.setMsgReadSuccessCallBack=function(){},this.setMsgReadErrorCallBack=function(){},this.deleteMsg=function(e){var s=e.id.substring("delete_".length);this.DeleteMessage(s,MessageBundle.deleteMsgSuccessCallBack,MessageBundle.deleteMsgErrorCallBack)},this.deleteMsgSuccessCallBack=function(){MessageBundle.SearchMessages(!1,null,!0,MessageBundle.showMsgSuccessCallBack,MessageBundle.showMsgErrorCallBack)},this.deleteMsgErrorCallBack=function(){},this.SearchMessages=function(e,s,t,n,a){$.ajax({type:"GET",dataType:"json",url:this.contextPath+"/system/getmessages.htm",data:{mailbox:t?"in":"out",keywords:"",startdate:"",enddate:"",isread:s,isflaged:"",isgetcount:e},success:function(e){n(e)},error:function(e){a(e)}})},this.SetMessageRead=function(e,s,t,n){$.ajax({type:"POST",dataType:"json",url:this.contextPath+"/system/setmessageread.htm",data:{messageid:s,read:e},success:function(e){t(e)},error:function(e){n(e)}})},this.DeleteMessage=function(e,s,t){$.ajax({type:"POST",dataType:"json",url:this.contextPath+"/system/deletemessage.htm",data:{messageid:e},success:function(e){s(e)},error:function(e){t(e)}})},this.SendMessage=function(e,s,t,n,a){isNotEmptyString(e)&&isNotEmptyString(s)&&$.ajax({type:"POST",dataType:"json",url:this.contextPath+"/system/savemessage.htm",data:{receiverids:JSON.stringify(e),title:s,content:t},success:function(e){n(e)},error:function(e){a(e)}})}};