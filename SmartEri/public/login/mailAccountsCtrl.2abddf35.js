!function(){"use strict";var e=angular.module("mailAccountModule",[]);e.controller("mailAccountsCtrl",["$scope","$state","$stateParams","httpService","setPublicMethod","mAlert","configService",function(e,o,i,s,t,r,l){e.configService=l,e.bytesToSize=t.bytesToSize,e.modify=function(e){o.go("mailaccounts.add",{modifyId:e})},e["delete"]=function(o){r.alert({title:"提示",body:"您确定要删除此账号吗？",btns:[{"class":"btn-sure",classmore:"btn-lg",text:"确定",cb:function(){s.mailAccounts["delete"]({userid:t.getUserId(),popuserid:e.configService.mailFolders.multiMails[o].name}).then(function(i){if(i&&200==i.status){e.configService.mailFolders.multiMails.splice(o,1),e.configService.multiMails=[];for(var s=0,t=e.configService.mailFolders.multiMails.length;t>s;s++)e.configService.multiMails.push(e.configService.mailFolders.multiMails[s].name)}else r.msg({type:"error",msg:"操作失败，请稍后重试！"})})}},{"class":"btn-cancle",text:"取消"}]})},e.addMailaccounts=function(){o.go("mailaccounts.add")};var n=i.popuserid;if(n&&n.trim()){var a={userid:t.getUserId(),priority:1,popuserid:n};if(e.showFlag="",l.mailFolders.multiMails)for(var p=0;p<l.mailFolders.multiMails.length;p++)if(n===encodeURIComponent(l.mailFolders.multiMails[p].name)){e.showFlag=l.mailFolders.multiMails[p].folder_id;break}s.mailAccounts.getMail(a,function(){e.configService.getFolderListData().then(function(){e.showFlag=""})},function(o){e.configService.failServeArr=o,r.msg({type:"error",msg:"代收邮箱收取失败"});for(var i=0,s=e.configService.mailFolders.multiMails.length;s>i;i++)for(var t=0,l=o.length;l>t;t++)if(e.configService.mailFolders.multiMails[i].name===o[t].popuserid){e.configService.mailFolders.multiMails[i].failRecive=!!o[t].status;break}})}}]),e.filter("showText",function(){return function(e){return e.failRecive?"验证失败":"正常"}}),e.controller("addAccountsCtrl",["$scope","$state","$stateParams","$location","httpService","setPublicMethod","mAlert","configService",function(e,o,i,s,t,r,l,n){e.options={userid:r.getUserId(),popuserid:"",poppassword:"",firstpopflag:0,autopop:0,reservecopy:1,sslflag:0,popserver:"",popport:110},e.message="添加",e.newMaliFlag=!0;var a=i.modifyId;if(n.mailFolders.multiMails&&n.mailFolders.multiMails[a]){e.message="修改";var p=n.mailFolders.multiMails[a];t.mailAccounts.list({userid:r.getUserId(),popuserid:p.name}).then(function(o){o[0]&&(e.options=o[0],e.options.poppassword="",e.options.userid=r.getUserId(),e.newMaliFlag=!1)})}e.checkBox=function(o,i){e.options[o]=(i+3)%2},e.$watch("options.popuserid",function(o,i,s){e.options.popserver=r.POPService(o)}),e.$watch("options.sslflag",function(o,i,s){e.options.popport=o?995:110}),e.save=function(){var i=e.newMaliFlag?"验证失败，请确认您的邮箱信息（邮箱地址/密码/POP服务器地址）是否正确":"账户验证失败，请检查",s=e.newMaliFlag?"新建成功":"修改设置成功";if(e.options.userid&&e.options.popuserid&&e.options.poppassword&&e.options.popserver&&e.options.popport){if(!e.options.popuserid.isMail())return l.msg({type:"error",msg:"邮箱格式不正确！"}),!1;l.msg({type:"success",msg:"验证中...",handMovement:!0}),t.mailAccounts.newOrUpddte(e.newMaliFlag,{userid:e.options.userid,popuserid:e.options.popuserid,poppassword:e.options.poppassword,firstpopflag:e.options.firstpopflag,autopop:e.options.autopop,reservecopy:e.options.reservecopy,sslflag:e.options.sslflag,popserver:e.options.popserver,popport:e.options.popport}).then(function(t){l.handRemoveMsg(),!t||200!=t.status&&0!=t.errcode?403==t.status?l.msg({type:"error",msg:"邮箱已存在"}):l.msg({type:"error",msg:i}):(l.msg({type:"success",msg:s}),o.go("mailaccounts",{popuserid:encodeURIComponent(e.options.popuserid)}))})}else l.msg({type:"error",msg:"存在未填写的项！"})}}])}();