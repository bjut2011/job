!function(){"use strict";var e=angular.module("mailsModule",["maillistModule"]);e.controller("mailsCtrl",["$scope","$rootScope","$state","$stateParams","$http","configService","toolsBarService",function(e,t,o,r,i,a,l){e.configService=a,e.toolsBarService=l,e.configService.toolbar=!0;var n=o.$current.name.replace(/\.mail/,"");e.toolsActionConfig=l.TOOLS_ACTION_CONFIG[n],e.noDetail=!r.id}]),e.controller("toolBarCtrl",["$scope","$state","$stateParams","$compile","configService","mAlert","toolsBarService",function(e,t,o,r,i,a,l){function n(){return l.ids.length?!0:(a.msg({type:"error",msg:"请选择邮件"}),!1)}function s(r){return r?function(){var r=e.tools.orderIds.indexOf(1*o.id),i=e.tools.orderIds[r-1];i?t.go(t.$current.name,{id:i}):(e.tools.FROM_PREMAIL=!0,e.tools.prePage(!1),e.prevMailGrayFlag=!0)}:function(){if(!o.id)return void t.go(t.$current.name.replace(/\.mail/,"")+".mail",{id:e.tools.orderIds[0]});var r=e.tools.orderIds.indexOf(1*o.id),i=e.tools.orderIds[r+1];i?t.go(t.$current.name,{id:i}):(e.tools.FROM_NEXTMAIL=!0,e.tools.nextPage(!1),e.nextMailGrayFlag=!0)}}e.configService=i,e.tools=l,e.tools.stateParams=o,e.stateParams=o,e.showMoveById=function(e){return o.folderId?e==o.folderId:!1},e.spareBarF=function(){if(!e.tools.list.length)return void(e.tools.spareBar=!0);e.tools.spareBar=!e.tools.spareBar;var r=t.$current.name;return e.tools.stateParams=o,e.tools.MailGrayFlag(),e.tools.spareBar?(e.tools.inMail=!1,void t.go(r.replace(/\.mail/,""))):(angular.element("#noDetail").height(angular.element("#mailView").height()),void setTimeout(function(){e.$emit("scrollbar",{flag:"maillist",scrollEvent:"update"})},100))},e.deleteMail=function(l){if(n()){var s,c=t.$current.name.replace(/\.mail/,"");switch(s=i.mailFolders[c]?o.folderId?o.folderId:i.mailFolders[c].folder_id:"-10",l){case"delete":e.tools.apiWithMails("moveToFolder",s,i.mailFolders["delete"].folder_id);break;case"deleteForever":a.alert({title:"提示",body:"确定彻底删除邮件吗？<i class='delete-forever-reminder'>彻底删除的邮件将无法恢复</i>",btns:[{"class":"btn-sure",classmore:"btn-lg",text:"确定",cb:function(){e.tools.apiWithMails("del",s,null,!1),e.$apply()}},{"class":"btn-cancle",text:"取消"}]});break;case"deleteForeverAndReport":c=t.$current.name.replace(/\.mail/,""),e.spamType=[{type:1,text:"广告邮件"},{type:2,text:"未订阅期刊"},{type:3,text:"欺诈邮件、反动信息"},{type:4,text:"其他"}],e.nowSpamType=1,e.setSpamType=function(t){e.nowSpamType=t};var d=r('<div class="report"><div ng-repeat= "spam in spamType " ng-click="setSpamType(spam.type)"><span class="radio" type="switch" ng-class={"open":spam.type==nowSpamType}></span><span>{{spam.text}}</span></div></div>')(e);a.alert({title:"请选择举报类型",body:d,btns:[{"class":"btn-sure",text:"确定",cb:function(){e.tools.apiWithMails("del",s,null,e.nowSpamType)}},{"class":"btn-cancle",text:"取消"}]});break;default:return}}},e.mark=function(r,a){if(n()){var l={read:"markRead",star:"markStar"},s=t.$current.name.replace(/\.mail/,""),c=o.folderId?o.folderId:i.mailFolders[s].folder_id;e.tools.apiWithMails(l[r],c,null,a)}},e.move=function(r){if(n()){var a=t.$current.name.replace(/\.mail/,""),l=o.folderId?o.folderId:i.mailFolders[a].folder_id;e.tools.apiWithMails("moveToFolder",l,r)}},e.sort=e.tools.sort,e.back=function(){e.tools.listHide=!1,e.tools.inMail=!1,e.tools.chooseNothing(),t.go(t.$current.name.replace(".mail",""))},e.preMail=s(!0),e.nextMail=s(!1)}]),e.controller("maillistCtrl",["$scope","$rootScope","$state","$stateParams","$http","configService","toolsBarService","setPublicMethod","httpService",function(e,t,o,r,i,a,l,n,s){function c(){e.tools.listHide=!1,e.tools.inMail=!1,e.tools.nowPage=1,e.tools.ids=[],e.tools.nowMail=null,e.tools.list=[],e.tools.total=0;var t=o.$current.name.replace(/\.mail/,"");if(e.adShow=!0,e.isDraft="draft"==t||"delete"==t||"spam"==t,e.tools.getList(r.searchText),e.fromFlag=function(){return"unread"===t},!e.tools.spareBar)var i=setInterval(function(){angular.element("#mailView").height()&&(angular.element("#noDetail").height(angular.element("#mailView").height()),clearInterval(i))},100)}e.tools=l,e.tools.stateParams=r,e.configService=a,e.tools.mailListScope=e,e.httpService=s,e.bytesToSize=n.bytesToSize,e.ads=[],c(),e.prePage=e.tools.prePage,e.nextPage=e.tools.nextPage,e.mailChoose=function(t){t.choosed=!t.choosed,t.choosed?e.tools.ids.push(t.id):e.tools.ids.splice(e.tools.ids.indexOf(t.id),1)},e.toMailDetail=function(t){var r=o.$current.name.replace(/\.mail/,""),i=r+".mail";return e.tools.nowMail=t,"draft"==r?(o.go("write",{id:t.id}),!1):(e.tools.spareBar?e.tools.listHide=!0:e.tools.listHide=!1,void o.go(i,{id:t.id}))},e.toggleStar=function(t){e.tools.chooseNothing(),e.tools.ids.push(t.id);var o=0!=t.star?0:1,r=t.folderId;e.tools.apiWithMails("markStar",r,null,o)},e.$watch("tools.pages",function(t,o){t!==o&&e.tools.nowPage!=e.tools.pages.value&&(e.tools.nowPage=e.tools.pages.value,e.tools.getList(r.searchText,e.tools.nowSortType))},!0),e.$on("getList",function(){e.tools.getList(r.searchText,e.tools.nowSortType)})}]),e.directive("showOrHide",function(){return{restrict:"A",link:function(e,t,o){t.on("click",function(){$(this).siblings(".mail-group").fadeToggle()})}}}),e.directive("spare",function(){return{restrict:"A",link:function(e,t,o){var r=e.tools.spareBar?"100%":"40%";t.css("width",r)}}}),e.filter("dateFormate",function(){var e=function(e,t){var o="",r=new Date,i=r.pattern("yyyy-MM-dd");r.setDate(r.getDate()-1);var a=r.pattern("yyyy-MM-dd"),l=e.slice(0,10);return l==i?(o="今天",o+=e.slice(10,e.length-7).trim()):l==a?(o="昨天",o+=e.slice(10,e.length-7).trim()):o=e.slice(0,10),o};return e}),e.filter("keyWordRender",["$sce","toolsBarService","setPublicMethod",function(e,t,o){var r=function(r){var i=r,a=t.key;return void 0!=a&&0!=a.length&&(a.sort(function(e,t){return e.length<t.length}),a.forEach(function(e){var t=new RegExp("("+e+")","g");i=i.replace(t,"<b>$1</b>")})),i=o.htmlTransferredMeaning(i),e.trustAsHtml(i)};return r}]),e.filter("metionWord",function(){return function(e){var t=e.isReply?"已回复":e.isFwd?"已转发":e.hasRead?"":"未读";return t}}),e.directive("contentWidth",function(){return{restrict:"EA",link:function(e,t,o){t.css({width:document.body.clientWidth-970+"px"})}}}),e.directive("textAd",function(){return{restrict:"EA",link:function(e,t,o){e.httpService.index.getAd().then(function(o){if(0===Number(o.status))if(e.ads.length||(e.ads.push(o.data.listAdTop),e.ads.push(o.data.listAdBottom)),1!=e.ads[0].length){var r=Math.round(100/e.ads[0].length);setTimeout(function(){t.find("a").css({width:r+"%"}),t.show()},50)}else t.show()})}}}),e.directive("textAdSpare",function(){return{restrict:"EA",link:function(e,t,o){e.httpService.index.getAd().then(function(o){if(0===Number(o.status)&&(e.ads.length||(e.ads=o.data.listAd||[]),setTimeout(function(){t.find("a").css({width:"100%",display:"block"}),t.show()},50),e.ads.length>1)){var r=0;setInterval(function(){r++,t.find("a").hide(),t.find("a").eq(r).show("slow"),r=2>r?r:0},2e3)}})}}}),e.filter("toTrusted",["$sce","setPublicMethod",function(e,t){return function(o,r){if(o=t.htmlTransferredMeaning(o),r)for(var i=0,a=r.length;a>i;i++){var l=new RegExp(r[i],"g"),n='<i style="color:#FF0000;font-weight:bold;">'+r[i]+"</i>";o=o.replace(l,n)}return e.trustAsHtml(o)}}])}();