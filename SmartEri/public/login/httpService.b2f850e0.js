!function(){var e=angular.module("httpModule",[]);e.factory("httpService",["$http","$q","contactsService",function(e,r,t){function n(e,r,t){v.getstatus({id:e,t:Number((new Date).getTime())}).then(function(o){if(o){for(var i=!1,a=0,u=0,s=o.length;s>u;u++){if(1===Number(o[u].status)){i=!0;break}0===Number(o[u].status)&&a++}if(i)return setTimeout(function(){n(e,r,t)},1e3);for(var f=0,c=o.length;c>f;f++)for(var d=0,p=v.idMapMail.length;p>d;d++)if(o[f].id==v.idMapMail[d].id){o[f].popuserid=v.idMapMail[d].popuserid;break}return a===s?r(o):t(o)}})}var o=function(r,t,n){var o={method:"get",url:r};if(n){var i=[];for(var a in n)!function(e){i.push(e+"="+n[e])}(a);o.url=o.url+"?"+i.join("&"),o.headers={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}e(o).success(function(e){t.resolve(e)}).error(function(){t.reject("There was an error")})},i=function(r,t,n,o,i){var a=[],u={};if(i)u={method:"post",url:r,data:t};else{for(var s in t)!function(e){o?a.push(e+"="+JSON.stringify(t[e])):a.push(e+"="+t[e])}(s);u={method:"post",url:r,data:a.join("&"),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}}e(u).success(function(e){n.resolve(e)}).error(function(){n.reject("There was an error")})},a=function(r,t,n){var o=[];for(var i in t)!function(e){o.push(e+"="+t[e])}(i);e({method:"delete",url:r,data:o.join("&"),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){n.resolve(e)}).error(function(){n.reject("There was an error")})},u=function(r,t,n){var o=[];for(var i in t)!function(e){o.push(e+"="+t[e])}(i);e({method:"put",url:r,data:o.join("&"),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(e){n.resolve(e)}).error(function(){n.reject("There was an error")})},s={get:function(){var e=r.defer();return o("baseSet/",e),e.promise},set:function(e){var t=r.defer();return i("baseSet/",e,t),t.promise}},f={getSign:function(){var e=r.defer();return o("getSign/",e),e.promise},UploadPicture:function(e,t){var n=r.defer();return i("sign/act/UploadPicture?flag=0&domain=0&email="+e,t,n),n.promise},ImageHandle:function(e){var t=r.defer();return i("sign/act/ImageHandle",e,t),t.promise},updateSign:function(e){var t=r.defer();return i("updateSign/",e,t),t.promise}},c={getList:function(e,r){t.fetchData(e,r)},addWhite:function(e){var n=r.defer();return i("address/addWhite",e,n),t.setDirty(),n.promise},rmWhite:function(e){var n=r.defer();return i("address/rmWhite",e,n),t.setDirty(),n.promise}},d={getList:function(e,r){t.fetchData(e,r)},addBlack:function(e){var n=r.defer();return i("address/addBlack_v2",e,n),t.setDirty(),n.promise},rmBalck:function(e){var n=r.defer();return i("address/rmBlack_v2",e,n),t.setDirty(),n.promise}},p={get:function(){var e=r.defer();return o("senderSet/",e),e.promise},set:function(e){var t=r.defer();return i("senderSet/",e,t),t.promise}},l={get:function(){var e=r.defer();return o("replyForward/",e),e.promise},set:function(e){var t=r.defer();return i("replyForward/",e,t),t.promise},bindQuery:function(){var e=r.defer();return o("phone/bind/query/",e),e.promise},getVerCode:function(e){var t=r.defer();return i("phone/msg/reply/",e,t,!1,!0),t.promise},bindPhone:function(e){var t=r.defer();return i("phone/bind/",e,t,!1,!0),t.promise}},m={get:function(){var e=r.defer();return o("filter",e),e.promise},set:function(e){var t=r.defer();return i("filter",e,t,!0),t.promise}},v={list:function(e){var t=r.defer();return i("pop/list",e,t),t.promise},newOrUpddte:function(e,t){var n="pop/"+(e?"":"update"),o=r.defer();return e?u(n,t,o):i(n,t,o),o.promise},"delete":function(e){var t=r.defer();return a("pop/",e,t),t.promise},getpop:function(e){var t=r.defer();return o("pop/pop",t,e),t.promise},getstatus:function(e){var t=r.defer();return o("pop/status",t,e),t.promise},getMail:function(e,r,t){v.getpop(e).then(function(e){v.idMapMail=e;var o=[];if(e&&e.errcode)return t()||!1;if(e&&e.length>0){for(var i=0,a=e.length;a>i;i++)o.push(e[i].id);n(o.join(","),r,t)}})},idMapMail:{}},h={getUserData:function(e){var t=r.defer();return o("user/data",t,e),t.promise},getScore:function(){var e=r.defer();return o("score_webapi/hotgoods",e),e.promise},getWeather:function(e){var t=r.defer();return o("weather",t,e),t.promise},getCity:function(){var e=r.defer();return o("data/cityMap.json",e),e.promise},getAd:function(){var e=r.defer();return o("score_webapi/mailad",e),e.promise},logout:function(){return e.post("logout")},sysMailCheckParam:{t:0,i:0},sysMailCheck:function(){var e=this.sysMailCheckParam,t=r.defer();return o("mail/check?t="+e.t+"&i="+e.i,t),t.promise},getNotice:function(){var e=r.defer();return o("protocol/notice",e),e.promise}},g={addother:function(e){var t=r.defer();return u("otherFolder/",e,t),t.promise},deleteother:function(e){var t=r.defer();return a("otherFolder/",e,t),t.promise},renameother:function(e){var t=r.defer();return i("otherFolder/",e,t),t.promise},clearother:function(e){var t=r.defer();return a("folderClear/",e,t),t.promise}},w={getToken:function(e){var t=r.defer();return o("attach/token",t,e),t.promise}},y={postProtocol:function(e){var t=r.defer();return i("protocol/",e,t,!1,!0),t.promise},getProtocol:function(e){var t=r.defer();return o("protocol/",t),t.promise}},k={getSkinUser:function(e){var t=r.defer();return o("skin/user/",t),t.promise},getSkin:function(e){var t=r.defer();return o("skin/",t),t.promise},postSkin:function(e){var t=r.defer();return i("skin/",e,t,!1,!0),t.promise}};return{whiteList:c,blackList:d,mailAccounts:v,index:h,setAddresserInfo:p,setAutoreply:l,otherFolder:g,baseSet:s,sign:f,filter:m,writeMail:w,protocol:y,skin:k}}])}();