!function(){"use strict";var e=angular.module("fileUploadModel",[]);e.service("fileUploadService",["$http","mAlert",function(e,t){var a=this;a.uploadByAjax=function(e){var t={url:"",type:"post",dataType:"json",data:null,progress:function(){},success:function(){},error:function(){},complete:function(){}};$.extend(!0,t,e);var a=new FormData,n=t.data;for(var o in n)a.append(o,n[o]);$.ajax({url:t.url,type:t.type,dataType:t.dataType,data:a,processData:!1,contentType:!1,xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){e.lengthComputable&&t.progress(e)},!1),e},success:function(e){t.success(e)},error:function(e){t.error(e)},complete:function(e){t.complete(e)}})},a.uploadByIframe=function(e){var t={url:"",dataType:"json",fileInputSlct:"input[type=file]",extraData:null,progress:function(){},complete:function(){}};$.extend(!0,t,e);var a=t.fileInputSlct,n=t.extraData,o="iframeForUpload"+(new Date).getTime(),r=$('<iframe name="'+o+'" id="'+o+'" style="display: none"></iframe>');$("body").append(r);var i=$(a).parent(),p=$('<form style="display:none;"></form>');p.attr({method:"post",enctype:"multipart/form-data",action:t.url,target:o}),p.append($(a));for(var l in n)p.append('<input name="'+l+'" value="'+n[l]+'"/>');$("body").append(p),p.submit();var d=p.find(a).clone();i.append(d),p.remove();var s={loaded:0,total:100,waitPoint:95},c=setInterval(function(){if(s.loaded<=s.waitPoint){var e=s.loaded+parseInt(5*Math.random());s.loaded=Math.min(e,s.waitPoint),t.progress(s)}},50);$("#"+o).one("load",function(){clearInterval(c),s.loaded=s.total,t.progress(s);var e,a=this.contentWindow.document.body.innerHTML;switch(t.dataType){case"text":e=a;break;case"json":try{e=JSON.parse(a)}catch(n){e=null}}t.complete(e),$(this).remove()})}}])}();